<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Yuma Seismometer Capacitive Displacement Sensor Simulator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/src/styles.css" />
</head>
<body>
  <main class="wrap">
    <header class="hero">
      <div class="hero-badge">LTC1043</div>
      <div class="hero-content">
        <h1>Yuma Seismometer Capacitive Displacement Sensor Simulator</h1>
        <p class="hero-summary">
          This simulator models the capacitive displacement sensor front-end used in the Yuma seismometer circuit.
          Change the plate geometry and timing settings to see how the output voltage responds.
        </p>
        <div class="hero-links" role="note" aria-label="Circuit source references">
          <a class="hero-link" href="https://www.groundmotion.org/main.html" target="_blank" rel="noopener noreferrer">
            Source Page: groundmotion.org
          </a>
          <a class="hero-link" href="https://www.groundmotion.org/Yuma2.pdf" target="_blank" rel="noopener noreferrer">
            Board Circuit: Yuma2.pdf
          </a>
        </div>
      </div>
    </header>

    <section class="layout">
      <aside class="panel sidebar" aria-label="Inputs panel">
        <h2><span class="panel-icon">&#9881;</span> Parameters</h2>

        <fieldset class="input-group">
          <legend>Sensor Geometry</legend>
          <div class="field-grid">
            <div class="field">
              <label for="widthCm">Plate width <span class="unit">(cm)</span></label>
              <input id="widthCm" type="number" step="any" min="0.001" />
            </div>

            <div class="field">
              <label for="heightCm">Plate height <span class="unit">(cm)</span></label>
              <input id="heightCm" type="number" step="any" min="0.001" />
            </div>

            <div class="field wide">
              <label for="plateAreaInfo">Computed plate area <span class="unit">(cm²)</span></label>
              <input id="plateAreaInfo" type="text" readonly />
            </div>

            <div class="field">
              <label for="totalGapMm">Total gap G <span class="unit">(mm)</span></label>
              <input id="totalGapMm" type="number" step="any" min="0.0001" />
            </div>

            <div class="field">
              <label for="minGapMm">Min gap clamp <span class="unit">(mm)</span></label>
              <input id="minGapMm" type="number" step="any" min="0.00001" />
            </div>
          </div>
        </fieldset>

        <fieldset class="input-group">
          <legend>Position</legend>
          <div class="field-grid">
            <div class="field wide">
              <label for="position">Position fraction p <span class="unit">(0 left, 1 right)</span></label>
              <div class="range-row">
                <input id="position" type="range" min="0" max="1" step="any" />
                <input id="positionText" type="text" readonly class="range-readout" />
              </div>
            </div>

            <div class="field wide">
              <label for="positionOffsetMm">Offset from center <span class="unit">(mm, +right / −left)</span></label>
              <input id="positionOffsetMm" type="number" step="0.1" />
            </div>
          </div>
        </fieldset>

        <fieldset class="input-group">
          <legend>Switching</legend>
          <div class="field-grid">
            <div class="field wide">
              <label for="freqHz">Switching frequency <span class="unit">(Hz)</span></label>
              <input id="freqHz" type="number" step="any" min="1" />
            </div>
          </div>
        </fieldset>

        <details open>
          <summary>Advanced Components</summary>
          <div class="field-grid" style="margin-top: 0.45rem;">
            <div class="field">
              <label for="vDrivePeakV">Drive Vpeak <span class="unit">(V)</span></label>
              <input id="vDrivePeakV" type="number" step="any" min="0.01" />
            </div>

            <div class="field">
              <label for="epsilonR">Dielectric εr <span class="unit">(air)</span></label>
              <input id="epsilonR" type="number" readonly />
            </div>

            <div class="field">
              <label for="r10Ohm">R10 <span class="unit">(Ω)</span></label>
              <input id="r10Ohm" type="number" step="any" min="1" />
            </div>

            <div class="field">
              <label for="r11Ohm">R11 <span class="unit">(Ω)</span></label>
              <input id="r11Ohm" type="number" step="any" min="1" />
            </div>

            <div class="field">
              <label for="iBiasPA">Op-amp input bias <span class="unit">(pA)</span></label>
              <input id="iBiasPA" type="number" step="any" />
            </div>

            <div class="field">
              <label for="c3F">C3 <span class="unit">(pF)</span></label>
              <input id="c3F" type="number" step="any" min="0.001" />
            </div>

            <div class="field">
              <label for="c4F">C4 <span class="unit">(pF)</span></label>
              <input id="c4F" type="number" step="any" min="0.001" />
            </div>

            <div class="field wide">
              <label for="ccF">Cc mutual (A-B) <span class="unit">(pF)</span></label>
              <input id="ccF" type="number" step="any" min="0" />
            </div>
          </div>
        </details>

        <details>
          <summary>Sweep Controls</summary>
          <div class="field-grid" style="margin-top: 0.45rem;">
            <div class="field">
              <label for="freqMinHz">Freq min <span class="unit">(Hz)</span></label>
              <input id="freqMinHz" type="number" step="any" min="1" />
            </div>
            <div class="field">
              <label for="freqMaxHz">Freq max <span class="unit">(Hz)</span></label>
              <input id="freqMaxHz" type="number" step="any" min="1" />
            </div>
            <div class="field">
              <label for="freqPoints">Freq points</label>
              <input id="freqPoints" type="number" step="any" min="8" max="500" />
            </div>

            <div class="field">
              <label for="gapMinMm">Gap min <span class="unit">(mm)</span></label>
              <input id="gapMinMm" type="number" step="any" min="0.0001" />
            </div>
            <div class="field">
              <label for="gapMaxMm">Gap max <span class="unit">(mm)</span></label>
              <input id="gapMaxMm" type="number" step="any" min="0.0001" />
            </div>
            <div class="field">
              <label for="gapPoints">Gap points</label>
              <input id="gapPoints" type="number" step="any" min="8" max="500" />
            </div>

            <div class="field wide">
              <label for="positionPoints">Position points</label>
              <input id="positionPoints" type="number" step="any" min="8" max="500" />
            </div>
          </div>
        </details>
      </aside>

      <section style="display:grid; gap: 1rem;">
        <section class="panel" aria-label="Metrics panel">
          <h2><span class="panel-icon">&#9632;</span> Simulation Metrics</h2>
          <div class="metrics-grid" id="metrics"></div>
          <div id="warnings"></div>

          <div class="validation">
            <h3>Validation <span class="validation-tag">Reference</span></h3>
            <div class="row head">
              <div>Metric</div>
              <div>Computed</div>
              <div>Reference / Deviation</div>
            </div>
            <div id="validationRows"></div>
            <p class="validation-note">
              "Doc fixture" rows use fixed application-note parameters for apples-to-apples reference.
              "Current inputs" rows use your active parameter values.
            </p>
          </div>
        </section>

        <section class="panel charts" aria-label="Charts panel">
          <h2><span class="panel-icon">&#9473;</span> Charts</h2>

          <article class="chart-card">
            <div class="chart-head">
              <p class="title">Vout vs Switching Frequency</p>
              <p class="sub">Log-frequency sweep</p>
            </div>
            <div class="chart-plot">
              <canvas id="chartFreq" width="900" height="260"></canvas>
            </div>
          </article>

          <article class="chart-card">
            <div class="chart-head">
              <p class="title">Vout vs Position Fraction</p>
              <p class="sub">Centered sweep (p = 0.1 to 0.9)</p>
            </div>
            <div class="chart-plot">
              <canvas id="chartPos" width="900" height="260"></canvas>
            </div>
          </article>

          <article class="chart-card">
            <div class="chart-head">
              <p class="title">Vout vs Total Separation G</p>
              <p class="sub">Gap sweep at fixed frequency and position</p>
            </div>
            <div class="chart-plot">
              <canvas id="chartGap" width="900" height="260"></canvas>
            </div>
          </article>

          <article class="chart-card">
            <div class="chart-head">
              <p class="title">Sensor Node Voltages Over One Clock Cycle</p>
              <p class="sub">Time-domain Va and Vb from R10/R11/Ca/Cb/Cc with ±V drive</p>
            </div>
            <div class="chart-plot">
              <canvas id="chartSensorCycle" width="900" height="260"></canvas>
            </div>
          </article>

          <article class="chart-card">
            <div class="chart-head">
              <p class="title">Solver Iteration Trace</p>
              <p class="sub">Operating-point fixed-point iterations (V3 and Vout)</p>
            </div>
            <div class="chart-plot">
              <canvas id="chartSolverTrace" width="900" height="260"></canvas>
            </div>
          </article>

          <article class="chart-card">
            <div class="chart-head">
              <p class="title">Solver Residual per Iteration</p>
              <div class="chart-controls">
                <label for="residualScale">Scale</label>
                <select id="residualScale">
                  <option value="linear">Linear</option>
                  <option value="log">Log10</option>
                </select>
              </div>
            </div>
            <div class="chart-plot">
              <canvas id="chartSolverResidual" width="900" height="260"></canvas>
            </div>
          </article>
        </section>

        <section class="panel docs" aria-label="Documentation panel">
          <h2><span class="panel-icon">&#9776;</span> Model Notes</h2>
          <p>
            This page follows the same front-end topology as the Ground Motion Yuma2 circuit linked below.
            It is not a calibrated electrical replica of the full board.
          </p>
          <p>
            Capacitances are computed with ideal parallel-plate physics:
            <code>C = ε0·εr·A/d</code> where <code>A = width·height</code> and
            <code>dLeft = max(minGap, p·G)</code>, <code>dRight = max(minGap, (1-p)·G)</code>.
          </p>
          <p>
            Bidirectional switched-cap model:
            each cycle samples the RC-attenuated differential sensor voltage onto <code>C3</code>, then applies charge
            sharing between <code>C3</code> and <code>C4</code>, plus an output shift from op-amp input bias current.
            The parameter <code>Cc</code> is modeled as mutual capacitance between sensor nodes A and B.
            The sensor-node operating point (<code>Va</code>, <code>Vb</code>) is solved from a coupled RC nodal model.
            Periodic steady-state is solved iteratively from <code>x[n+1]=F(x[n])</code>.
            Polarity is mapped so rightward motion is positive.
          </p>
          <p>
            Simplifications: front-end only (no U1A/integrator/coil loop), no fringing, no plate-thickness effects,
            RC transients for the one-cycle sensor-node chart are integrated numerically under a ±V square-wave drive,
            the <code>5·max(τA, τB)</code> check is a heuristic indicator only, and
            an output clamp (±12V in this model) to avoid non-physical runaway values.
          </p>
          <p>
            Circuit source references:
            <a href="https://www.groundmotion.org/main.html" target="_blank" rel="noopener noreferrer">groundmotion.org/main.html</a>,
            <a href="https://www.groundmotion.org/Yuma2.pdf" target="_blank" rel="noopener noreferrer">groundmotion.org/Yuma2.pdf</a>.
          </p>
          <p>
            This simulator was built with AI assistance using Codex and Claude and may contain inaccuracies.
            It was created primarily as a learning tool to improve understanding of the working principles
            of this type of capacitive sensor front-end.
          </p>
        </section>
      </section>
    </section>
  </main>

  <script type="module" src="/src/app.js"></script>
</body>
</html>
